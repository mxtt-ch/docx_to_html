# ScholarHub DOCX转HTML转换器

## 项目简介

本项目是一个专业的DOCX文档转HTML转换器，专为将ScholarHub数智服务平台的DOCX文档转换为HTML网页而设计。转换器基于原生XML解析，能够完整保留原文档的显示效果、布局、样式和功能。

## 核心功能

### ✅ 已实现功能

1. **完整的DOM树遍历**
   - 递归遍历DOCX文档的XML结构
   - 准确识别段落、标题、表格、图片等所有元素类型

2. **标题层级转换**
   - 自动识别标题样式（heading 1-6）
   - 转换为对应的H1-H6标签
   - 生成唯一ID支持页面内跳转

3. **目录跳转功能**
   - 自动识别目录条目（TOC样式）
   - 生成可点击的目录链接
   - 支持页码和连接符的智能清理

4. **样式完整保留**
   - 基于XML动态生成CSS样式
   - 支持字体、字号、颜色、对齐方式等
   - 支持行间距、段落间距、缩进等排版属性

5. **项目符号和编号**
   - 识别项目符号并转换为HTML列表
   - 支持多级编号格式
   - 保持原有的编号样式和间隔

6. **超链接处理**
   - 识别文档中的超链接
   - 转换为可点击的HTML链接
   - 保持链接样式

7. **表格转换**
   - 将DOCX表格转换为HTML table标签
   - 保持表格样式和边框
   - 支持单元格合并等复杂表格

8. **文本框处理**
   - 识别文本框并转换为div标签
   - 保持文本框的尺寸、位置、边框等样式
   - 支持空文本框的渲染

9. **图片转换**
   - 提取并转换图片为img标签
   - 保持图片尺寸和布局
   - 支持图片与文本的混排效果

10. **智能缩放适配**
    - 自动计算DOCX内容区宽度
    - 按比例缩放到1200px标准宽度
    - 保持图片、文本框等元素的正确比例

11. **进度条显示**
    - 实时显示转换进度
    - 线程安全的进度条渲染
    - 避免多次渲染问题

## 技术特性

### 架构设计
- **模块化设计**: 核心转换器 + 工具类 + 入口脚本
- **XML原生解析**: 不依赖第三方库，直接解析DOCX XML结构
- **样式继承链**: 支持样式继承和覆盖关系
- **错误处理**: 完善的异常处理和日志记录

### 核心算法
- **DOM树递归遍历**: 深度优先遍历文档结构
- **样式动态计算**: 基于XML属性实时计算CSS
- **缩放因子算法**: 根据内容区宽度智能计算缩放比例
- **文本清理算法**: 智能处理目录文本的页码和连接符

### 性能优化
- **并行处理**: 支持多线程图片处理
- **内存管理**: 大文件流式处理
- **缓存机制**: 样式计算结果缓存

## 文件结构

```
ScholarHub/
├── docx_to_html.py              # 主入口脚本
├── convert_docx_to_html.py       # 核心转换类
├── util.py                      # 工具函数库
├── requirements.txt              # 依赖包列表
├── README.md                    # 项目文档
├── target.md                    # 项目目标文档
└── test_output_final/            # 转换输出示例
    ├── guide.html               # 转换后的HTML文件
    ├── images/                 # 图片文件夹
    ├── xml/                    # XML文件备份
    └── convert_log.txt         # 转换日志
```

## 安装依赖

```bash
pip install -r requirements.txt
```

主要依赖包：
- `python-docx`: DOCX文档处理
- `Pillow`: 图片处理
- `tqdm`: 进度条显示
- `lxml`: XML解析（可选）

## 使用方法

### 基本用法

```bash
# 转换默认文档
python docx_to_html.py

# 转换指定文档
python docx_to_html.py -i "input.docx"

# 指定输出目录
python docx_to_html.py -i "input.docx" -o "output_folder"

# 指定HTML标题
python docx_to_html.py -i "input.docx" -t "自定义标题"
```

### 参数说明

- `-i, --input`: 输入的DOCX文件路径
- `-o, --output`: 输出目录路径（默认自动生成时间戳目录）
- `-t, --title`: HTML标题（默认使用文档标题）

### 编程接口

```python
from convert_docx_to_html import DocxToHTMLConverter

# 创建转换器实例
converter = DocxToHTMLConverter(
    docx_path="input.docx",
    output_html_path="output.html",
    images_dir="images/",
    xml_dir="xml/",
    log_file="convert.log",
    title="文档标题"
)

# 执行转换
converter.convert()
```

## 输出结果

转换完成后，会在指定目录生成：

```
output_时间戳/
├── guide.html              # 转换后的HTML文件
├── images/                 # 所有提取的图片
│   ├── image1.png
│   ├── image2.jpg
│   └── ...
├── xml/                    # DOCX的XML文件备份
│   ├── document.xml
│   ├── styles.xml
│   └── ...
└── convert_log.txt         # 详细的转换日志
```

## CSS样式规范

### Body样式
```css
body {
    width: 1200px;
    margin: 0 auto;
}
```

### 样式生成规则
- 所有CSS样式基于DOCX的XML属性动态生成
- 样式直接写入HTML标签的style属性
- 支持单位转换（EMU、Twip → 像素）
- 智能缩放适配1200px宽度

### 样式支持
- ✅ 字体族（font-family）
- ✅ 字体大小（font-size）
- ✅ 文字颜色（color）
- ✅ 背景色（background-color）
- ✅ 粗体（font-weight）
- ✅ 斜体（font-style）
- ✅ 下划线（text-decoration）
- ✅ 对齐方式（text-align）
- ✅ 行间距（line-height）
- ✅ 段落间距（margin）
- ✅ 缩进（text-indent）

## 日志分析

转换器会生成详细的日志文件，包含：

### 信息类型
- **资源加载**: XML文件和媒体文件的加载情况
- **样式分析**: 样式定义和继承链的解析
- **结构识别**: 标题、目录、表格等元素的识别
- **转换过程**: 每个元素的处理详情
- **错误诊断**: 遇到的问题和解决方案

### 日志示例
```
DOCX转HTML转换器 - 初始化
================================================================================
信息: 加载完成: 14 个XML文件, 131 个总parts
信息: 识别到 17 个标题
信息: 识别到 14 个目录条目
信息: 内容区宽度: 553px -> 目标1200px, SCALE=2.1700
================================================================================
```

## 故障排除

### 常见问题

1. **转换失败**
   - 检查DOCX文件是否损坏
   - 确认文件权限正确
   - 查看日志文件获取详细错误信息

2. **样式丢失**
   - 检查样式定义是否正确
   - 确认XML文件完整性
   - 查看convert_log中的样式解析日志

3. **图片不显示**
   - 检查images目录是否包含图片文件
   - 确认图片路径引用正确
   - 检查图片格式支持

4. **目录链接失效**
   - 确认标题ID生成正确
   - 检查目录文本匹配逻辑
   - 查看日志中的目录处理记录

### 性能优化

1. **大文件处理**
   - 确保足够的内存空间
   - 考虑分批处理
   - 监控转换进度

2. **图片处理**
   - 大图片可能处理较慢
   - 可考虑图片压缩
   - 检查磁盘空间

## 开发说明

### 代码结构

1. **docx_to_html.py**: 入口脚本和参数处理
2. **convert_docx_to_html.py**: 核心转换逻辑
3. **util.py**: 通用工具函数和样式处理

### 扩展开发

转换器采用模块化设计，支持功能扩展：

- 添加新的元素类型处理
- 扩展样式支持
- 自定义输出格式
- 集成其他转换功能

### 测试方法

```bash
# 运行转换测试
python docx_to_html.py -i "test.docx" -o "test_output"

# 检查HTML结果
# 在浏览器中打开 test_output/guide.html
# 查看转换日志 test_output/convert_log.txt
```

## 版本历史

### v1.0.0 (当前版本)
- ✅ 实现完整的DOCX到HTML转换
- ✅ 支持标题、段落、表格、图片等基本元素
- ✅ 实现样式完整保留
- ✅ 添加目录跳转功能
- ✅ 支持智能缩放适配
- ✅ 完善的错误处理和日志

## 技术支持

如有问题或建议，请：

1. 查看`convert_log.txt`日志文件
2. 检查输入DOCX文件格式
3. 确认依赖包正确安装
4. 提供详细的错误信息和复现步骤

## 许可证

本项目仅供内部使用，请勿用于商业用途。

---

**注意**: 本转换器专为ScholarHub数智服务平台文档优化设计，其他DOCX文档的转换效果可能有所差异。建议在使用前进行充分测试。